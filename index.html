<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1, viewport-fit=cover"/>
  <title>Schlaftagebuch v11 (PWA)</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="icons/icon-192.png">
  <link rel="stylesheet" href="styles.css">
  <script defer src="app.js"></script>
</head>
<body>
  <header class="topbar">
    <h1>Schlaftagebuch</h1>
  </header>

  <main>
    <section id="home" class="tab active">
      <div class="card">
        <h3>Heute</h3>
        <div class="stats kpi">
          <div class="stat"><h4>Zuletzt gespeichert</h4><div id="homeLast" class="big">â€“</div></div>
          <div class="stat"><h4>Ã˜ QualitÃ¤t (Woche)</h4><div id="homeQ" class="big">â€“</div></div>
          <div class="stat"><h4>Ã˜ Dauer (Woche)</h4><div id="homeH" class="big">â€“</div></div>
        </div>
        <div class="summary" style="margin-top:10px">
          <button onclick="navigate('entry')">+ Neuer Eintrag</button>
          <button class="secondary" onclick="navigate('week')">Wochenansicht</button>
        </div>
      </div>
    </section>

    <section id="entry" class="tab">
      <div class="card">
        <div class="row g2">
          <div class="col"><label for="dateInput">Datum</label><input type="date" id="dateInput"></div>
          <div class="col"><label for="bedTime">Zu Bett</label><input type="time" id="bedTime"></div>
          <div class="col"><label for="asleepTime">Eingeschlafen (ca.)</label><input type="time" id="asleepTime"></div>
          <div class="col"><label for="wakeTime">Aufgewacht</label><input type="time" id="wakeTime"></div>
          <div class="col"><label for="upTime">Aufgestanden</label><input type="time" id="upTime"></div>
        </div>
        <div class="checks">
          <label><input type="checkbox" id="noSleep"> Nicht geschlafen (durchgewacht)</label>
        </div>
      </div>

      <div class="grid-2">
        <div class="card">
          <h3>2. SchlafqualitÃ¤t</h3>
          <div id="gaugeQuality" class="gauge-wrap"></div>
        </div>
        <div class="card">
          <h3>5. Morgendliches Befinden</h3>
          <div id="gaugeFeeling" class="gauge-wrap"></div>
        </div>
      </div>

      <div class="card">
        <h3>2b. Einschlafen â€“ wie hat es geklappt?</h3>
        <div id="gaugeOnset" class="gauge-wrap"></div>
        <div id="onsetAutoFill" class="small"></div>
      </div>

      <div class="card">
        <h4>GrÃ¼nde, die das Einschlafen beeinflusst haben (Gewichtung & IntensitÃ¤t):</h4>
        <div id="onsetChips" class="chips" aria-label="Einschlaf-GrÃ¼nde">
          <button data-val="rumination" title="GrÃ¼beln/Sorgen">ğŸ§  GrÃ¼beln/Sorgen</button>
          <button data-val="screenLate" title="SpÃ¤te Screen-Time">ğŸ“± Screen spÃ¤t</button>
          <button data-val="caffeine" title="Koffein am Abend">â˜• Koffein</button>
          <button data-val="heavyMeal" title="Schweres Abendessen">ğŸ Schweres Essen</button>
          <button data-val="noise" title="GerÃ¤usche/Licht">ğŸ”Š GerÃ¤usche</button>
          <button data-val="pain" title="Schmerzen/Unwohlsein">ğŸ¤• Schmerzen</button>
          <button data-val="stress" title="Stress">âš¡ Stress</button>
        </div>
        <div class="row g2">
          <div class="col"><label for="onsetAddInput">Eigenen Grund hinzufÃ¼gen</label><input type="text" id="onsetAddInput" placeholder="z. B. Gedankenkarussell â€¦"></div>
          <div class="col"><label>&nbsp;</label><button id="onsetAddBtn" class="secondary">Zur Liste hinzufÃ¼gen</button></div>
        </div>
      </div>

      <div class="card">
        <h3>3. Tagschlaf</h3>
        <div class="row g2">
          <div class="col"><label>Tagschlaf?</label><div class="radio">
            <label><input type="radio" name="nap" value="yes"> Ja</label>
            <label><input type="radio" name="nap" value="no" checked> Nein</label>
          </div></div>
          <div class="col"><label for="napWhen">Wann?</label><input type="time" id="napWhen"></div>
          <div class="col"><label for="napDuration">Wie lange (Minuten)?</label><input type="number" id="napDuration" min="0" step="5" placeholder="0"></div>
        </div>
      </div>

      <div class="card">
        <h3>4. Aufwachen in der Nacht</h3>
        <div class="row g2">
          <div class="col"><label>Aufgewacht?</label><div class="radio">
            <label><input type="radio" name="awake" value="yes"> Ja</label>
            <label><input type="radio" name="awake" value="no" checked> Nein</label>
          </div></div>
          <div class="col"><label for="awakeCount">Wie oft (circa)?</label><input type="number" id="awakeCount" min="0" max="10" step="1" placeholder="0"></div>
        </div>
        <label>GrÃ¼nde:</label>
        <div class="chips" id="reasons" aria-label="Aufwach-GrÃ¼nde">
          <button data-val="toilet" title="Toilettengang">ğŸš» Toilettengang</button>
          <button data-val="rumination" title="GrÃ¼beln/Sorgen">ğŸ§  GrÃ¼beln</button>
          <button data-val="temp" title="Temperatur (zu warm/kalt)">ğŸŒ¡ï¸ Temperatur</button>
          <button data-val="discomfort" title="Unbequemlichkeit">ğŸ›ï¸ Unbequem</button>
          <button data-val="noiseLight" title="GerÃ¤usche/Licht">ğŸ”† GerÃ¤usch/Licht</button>
        </div>
        <div class="row g2">
          <div class="col"><label for="awakeAddInput">Eigenen Grund hinzufÃ¼gen</label><input type="text" id="awakeAddInput" placeholder="z. B. Albtraum â€¦"></div>
          <div class="col"><label>&nbsp;</label><button id="awakeAddBtn" class="secondary">Zur Liste hinzufÃ¼gen</button></div>
        </div>
        <label for="nightNotes">Notizen (ohne Uhrzeiten):</label>
        <textarea id="nightNotes" rows="3" placeholder="Kurze Notizen..."></textarea>
      </div>

      <div class="card">
        <div class="grid-3">
          <div>
            <h3>6. Trinkverhalten</h3>
            <div class="radio">
              <label><input type="radio" name="drink20" value="yes"> Nach 20 Uhr getrunken</label>
              <label><input type="radio" name="drink20" value="no" checked> Nein</label>
            </div>
            <label for="drinkMl">Menge (ml)</label>
            <input type="number" id="drinkMl" min="0" step="50" placeholder="0">
          </div>
          <div>
            <h3>7. Einschlafrituale</h3>
            <div class="chips" id="rituals" aria-label="Einschlafrituale">
              <button data-val="read" title="Gelesen">ğŸ“– Gelesen</button>
              <button data-val="music" title="Beruhigende Musik">ğŸµ Musik</button>
              <button data-val="breathing" title="AtemÃ¼bungen/Meditieren">ğŸ« AtemÃ¼bung</button>
              <button data-val="warmShower" title="Warme Dusche">ğŸš¿ Warme Dusche</button>
            </div>
            <div class="row g2" style="margin-top:6px">
              <div class="col"><label for="ritualAddInput">Eigenes Ritual hinzufÃ¼gen</label><input type="text" id="ritualAddInput" placeholder="z. B. Tagebuch, Tee, Dehnen â€¦"></div>
              <div class="col"><label>&nbsp;</label><button id="ritualAddBtn" class="secondary">Zur Liste hinzufÃ¼gen</button></div>
            </div>
          </div>
          <div>
            <h3>Extras</h3>
            <div class="checks">
              <label><input type="checkbox" id="caffeineEvening"> Koffein spÃ¤t</label>
              <label><input type="checkbox" id="screenTimeLate"> SpÃ¤te Screen-Time</label>
            </div>
          </div>
        </div>
      </div>

      <div class="actions">
        <button id="saveEntry">Speichern</button>
        <button class="secondary" id="newEntry">Neu</button>
        <button class="ghost" id="deleteEntry">Eintrag lÃ¶schen</button>
        <span id="toast" class="toast" role="status" aria-live="polite"></span>
      </div>
    </section>

    <section id="week" class="tab">
      <div class="card">
        <h3>WochenÃ¼bersicht</h3>
        <div id="weekCards" class="stats"></div>
        <div id="weekLists"></div>
        <div class="table-toggle"><button class="secondary" id="toggleTableBtn">Tabelle ein-/ausblenden</button></div>
        <div id="weekTableWrap" class="table-wrap hidden"></div>
      </div>
    </section>

    <section id="month" class="tab">
      <div class="card">
        <h3>MonatsÃ¼bersicht</h3>
        <div id="monthHeatmap" class="heatmap"></div>
        <div id="monthTrends" class="summary"></div>
      </div>
    </section>

    <section id="settings" class="tab">
      <div class="card">
        <h3>Einschlaf-GrÃ¼nde Â· Gewichtung</h3>
        <div id="weightsOnsetList" class="table-wrap"></div>
        <div class="row g2">
          <label class="checks"><input type="checkbox" id="adaptiveWeights" checked> Adaptives Lernen aktivieren</label>
          <button class="secondary" id="resetWeights">Gewichte zurÃ¼cksetzen</button>
        </div>
      </div>
      <div class="card">
        <h3>Daten</h3>
        <div class="row g2">
          <button id="exportJson">Export (JSON)</button>
          <button id="exportCsv">Export (CSV)</button>
          <label class="import"><input type="file" id="importJson" accept="application/json"> Import (JSON)</label>
          <button class="secondary" id="clearAll">Alle Daten lÃ¶schen</button>
        </div>
      </div>
    </section>
  </main>

  <nav id="bottomTabs" class="bottombar">
    <a data-tab="home" class="active">ğŸ <span>Home</span></a>
    <a data-tab="entry">ğŸ“<span>Eintrag</span></a>
    <a data-tab="week">ğŸ“Š<span>Woche</span></a>
    <a data-tab="month">ğŸ—“ï¸<span>Monat</span></a>
    <a data-tab="settings">âš™ï¸<span>Einst.</span></a>
  </nav>

  <script>
    if (location.protocol.startsWith('http') && 'serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js'));
    }
  </script>
</body>
</html>
