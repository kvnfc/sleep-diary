<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1, viewport-fit=cover"/>
  <title>Schlaftagebuch v11 (PWA)</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="icons/icon-192.png">
  <link rel="stylesheet" href="styles.css">
  <script defer src="app.js"></script>
</head>
<body>
  <header class="topbar">
    <h1>Schlaftagebuch</h1>
  </header>

  <main>
    <section id="home" class="tab active">
      <div class="card">
        <h3>Heute</h3>
        <div class="stats kpi">
          <div class="stat"><h4>Zuletzt gespeichert</h4><div id="homeLast" class="big">–</div></div>
          <div class="stat"><h4>Ø Qualität (Woche)</h4><div id="homeQ" class="big">–</div></div>
          <div class="stat"><h4>Ø Dauer (Woche)</h4><div id="homeH" class="big">–</div></div>
        </div>
        <div class="summary" style="margin-top:10px">
          <button onclick="navigate('entry')">+ Neuer Eintrag</button>
          <button class="secondary" onclick="navigate('week')">Wochenansicht</button>
        </div>
      </div>
    </section>

    <section id="entry" class="tab">
      <div class="card">
        <div class="row g2">
          <div class="col"><label for="dateInput">Datum</label><input type="date" id="dateInput"></div>
          <div class="col"><label for="bedTime">Zu Bett</label><input type="time" id="bedTime"></div>
          <div class="col"><label for="asleepTime">Eingeschlafen (ca.)</label><input type="time" id="asleepTime"></div>
          <div class="col"><label for="wakeTime">Aufgewacht</label><input type="time" id="wakeTime"></div>
          <div class="col"><label for="upTime">Aufgestanden</label><input type="time" id="upTime"></div>
        </div>
        <div class="checks">
          <label><input type="checkbox" id="noSleep"> Nicht geschlafen (durchgewacht)</label>
        </div>
      </div>

      <div class="grid-2">
        <div class="card">
          <h3>2. Schlafqualität</h3>
          <div id="gaugeQuality" class="gauge-wrap"></div>
        </div>
        <div class="card">
          <h3>5. Morgendliches Befinden</h3>
          <div id="gaugeFeeling" class="gauge-wrap"></div>
        </div>
      </div>

      <div class="card">
        <h3>2b. Einschlafen – wie hat es geklappt?</h3>
        <div id="gaugeOnset" class="gauge-wrap"></div>
        <div id="onsetAutoFill" class="small"></div>
      </div>

      <div class="card">
        <h4>Gründe, die das Einschlafen beeinflusst haben (Gewichtung & Intensität):</h4>
        <div id="onsetChips" class="chips" aria-label="Einschlaf-Gründe">
          <button data-val="rumination" title="Grübeln/Sorgen">🧠 Grübeln/Sorgen</button>
          <button data-val="screenLate" title="Späte Screen-Time">📱 Screen spät</button>
          <button data-val="caffeine" title="Koffein am Abend">☕ Koffein</button>
          <button data-val="heavyMeal" title="Schweres Abendessen">🍝 Schweres Essen</button>
          <button data-val="noise" title="Geräusche/Licht">🔊 Geräusche</button>
          <button data-val="pain" title="Schmerzen/Unwohlsein">🤕 Schmerzen</button>
          <button data-val="stress" title="Stress">⚡ Stress</button>
        </div>
        <div class="row g2">
          <div class="col"><label for="onsetAddInput">Eigenen Grund hinzufügen</label><input type="text" id="onsetAddInput" placeholder="z. B. Gedankenkarussell …"></div>
          <div class="col"><label>&nbsp;</label><button id="onsetAddBtn" class="secondary">Zur Liste hinzufügen</button></div>
        </div>
      </div>

      <div class="card">
        <h3>3. Tagschlaf</h3>
        <div class="row g2">
          <div class="col"><label>Tagschlaf?</label><div class="radio">
            <label><input type="radio" name="nap" value="yes"> Ja</label>
            <label><input type="radio" name="nap" value="no" checked> Nein</label>
          </div></div>
          <div class="col"><label for="napWhen">Wann?</label><input type="time" id="napWhen"></div>
          <div class="col"><label for="napDuration">Wie lange (Minuten)?</label><input type="number" id="napDuration" min="0" step="5" placeholder="0"></div>
        </div>
      </div>

      <div class="card">
        <h3>4. Aufwachen in der Nacht</h3>
        <div class="row g2">
          <div class="col"><label>Aufgewacht?</label><div class="radio">
            <label><input type="radio" name="awake" value="yes"> Ja</label>
            <label><input type="radio" name="awake" value="no" checked> Nein</label>
          </div></div>
          <div class="col"><label for="awakeCount">Wie oft (circa)?</label><input type="number" id="awakeCount" min="0" max="10" step="1" placeholder="0"></div>
        </div>
        <label>Gründe:</label>
        <div class="chips" id="reasons" aria-label="Aufwach-Gründe">
          <button data-val="toilet" title="Toilettengang">🚻 Toilettengang</button>
          <button data-val="rumination" title="Grübeln/Sorgen">🧠 Grübeln</button>
          <button data-val="temp" title="Temperatur (zu warm/kalt)">🌡️ Temperatur</button>
          <button data-val="discomfort" title="Unbequemlichkeit">🛏️ Unbequem</button>
          <button data-val="noiseLight" title="Geräusche/Licht">🔆 Geräusch/Licht</button>
        </div>
        <div class="row g2">
          <div class="col"><label for="awakeAddInput">Eigenen Grund hinzufügen</label><input type="text" id="awakeAddInput" placeholder="z. B. Albtraum …"></div>
          <div class="col"><label>&nbsp;</label><button id="awakeAddBtn" class="secondary">Zur Liste hinzufügen</button></div>
        </div>
        <label for="nightNotes">Notizen (ohne Uhrzeiten):</label>
        <textarea id="nightNotes" rows="3" placeholder="Kurze Notizen..."></textarea>
      </div>

      <div class="card">
        <div class="grid-3">
          <div>
            <h3>6. Trinkverhalten</h3>
            <div class="radio">
              <label><input type="radio" name="drink20" value="yes"> Nach 20 Uhr getrunken</label>
              <label><input type="radio" name="drink20" value="no" checked> Nein</label>
            </div>
            <label for="drinkMl">Menge (ml)</label>
            <input type="number" id="drinkMl" min="0" step="50" placeholder="0">
          </div>
          <div>
            <h3>7. Einschlafrituale</h3>
            <div class="chips" id="rituals" aria-label="Einschlafrituale">
              <button data-val="read" title="Gelesen">📖 Gelesen</button>
              <button data-val="music" title="Beruhigende Musik">🎵 Musik</button>
              <button data-val="breathing" title="Atemübungen/Meditieren">🫁 Atemübung</button>
              <button data-val="warmShower" title="Warme Dusche">🚿 Warme Dusche</button>
            </div>
            <div class="row g2" style="margin-top:6px">
              <div class="col"><label for="ritualAddInput">Eigenes Ritual hinzufügen</label><input type="text" id="ritualAddInput" placeholder="z. B. Tagebuch, Tee, Dehnen …"></div>
              <div class="col"><label>&nbsp;</label><button id="ritualAddBtn" class="secondary">Zur Liste hinzufügen</button></div>
            </div>
          </div>
          <div>
            <h3>Extras</h3>
            <div class="checks">
              <label><input type="checkbox" id="caffeineEvening"> Koffein spät</label>
              <label><input type="checkbox" id="screenTimeLate"> Späte Screen-Time</label>
            </div>
          </div>
        </div>
      </div>

      <div class="actions">
        <button id="saveEntry">Speichern</button>
        <button class="secondary" id="newEntry">Neu</button>
        <button class="ghost" id="deleteEntry">Eintrag löschen</button>
        <span id="toast" class="toast" role="status" aria-live="polite"></span>
      </div>
    </section>

    <section id="week" class="tab">
      <div class="card">
        <h3>Wochenübersicht</h3>
        <div id="weekCards" class="stats"></div>
        <div id="weekLists"></div>
        <div class="table-toggle"><button class="secondary" id="toggleTableBtn">Tabelle ein-/ausblenden</button></div>
        <div id="weekTableWrap" class="table-wrap hidden"></div>
      </div>
    </section>

    <section id="month" class="tab">
      <div class="card">
        <h3>Monatsübersicht</h3>
        <div id="monthHeatmap" class="heatmap"></div>
        <div id="monthTrends" class="summary"></div>
      </div>
    </section>

    <section id="settings" class="tab">
      <div class="card">
        <h3>Einschlaf-Gründe · Gewichtung</h3>
        <div id="weightsOnsetList" class="table-wrap"></div>
        <div class="row g2">
          <label class="checks"><input type="checkbox" id="adaptiveWeights" checked> Adaptives Lernen aktivieren</label>
          <button class="secondary" id="resetWeights">Gewichte zurücksetzen</button>
        </div>
      </div>
      <div class="card">
        <h3>Daten</h3>
        <div class="row g2">
          <button id="exportJson">Export (JSON)</button>
          <button id="exportCsv">Export (CSV)</button>
          <label class="import"><input type="file" id="importJson" accept="application/json"> Import (JSON)</label>
          <button class="secondary" id="clearAll">Alle Daten löschen</button>
        </div>
      </div>
    </section>
  </main>

  <nav id="bottomTabs" class="bottombar">
    <a data-tab="home" class="active">🏠<span>Home</span></a>
    <a data-tab="entry">📝<span>Eintrag</span></a>
    <a data-tab="week">📊<span>Woche</span></a>
    <a data-tab="month">🗓️<span>Monat</span></a>
    <a data-tab="settings">⚙️<span>Einst.</span></a>
  </nav>

  <script>
    if (location.protocol.startsWith('http') && 'serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js'));
    }
  </script>
</body>
</html>
